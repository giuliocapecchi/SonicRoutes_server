<h1>SonicRoutes Server</h1><p>Simple Flask server for the Mobile and Social Sensing System's course, academic year 2023/2024. This code is intended to be used in combination with the Android application provided at <a target="_new" rel="noreferrer" href="https://github.com/JacopoNiccolai/SonicRoutes">SonicRoutes</a>. The functionalities exposed by the server are detailed below.</p><h2>Table of Contents</h2><ul><li><a target="_new" rel="noreferrer" href="#installation">Installation</a></li><li><a target="_new" rel="noreferrer" href="#configuration">Configuration</a></li><li><a target="_new" rel="noreferrer" href="#usage">Usage</a><ul><li><a target="_new" rel="noreferrer" href="#routes">Routes</a><ul><li><a target="_new" rel="noreferrer" href="#getroute"><code>/getRoute</code></a></li><li><a target="_new" rel="noreferrer" href="#getcrossingcoordinates"><code>/getCrossingCoordinates/&lt;int:crossing_id&gt;</code></a></li><li><a target="_new" rel="noreferrer" href="#getcrossings"><code>/getCrossings/&lt;string:city&gt;</code></a></li><li><a target="_new" rel="noreferrer" href="#upload"><code>/upload</code></a></li></ul></li><li><a target="_new" rel="noreferrer" href="#webinterface">Web Interface</a><ul><li><a target="_new" rel="noreferrer" href="#home"><code>/</code></a></li><li><a target="_new" rel="noreferrer" href="#mappa_count"><code>/mappa_count</code></a></li><li><a target="_new" rel="noreferrer" href="#mappa_rumori"><code>/mappa_rumori</code></a></li></ul></li></ul></li><li><a target="_new" rel="noreferrer" href="#helper-functions">Helper Functions</a></li><li><a target="_new" rel="noreferrer" href="#file-structure">File Structure</a></li></ul><h2 id="installation">Installation</h2><p>To install the server, clone the repository and install the required dependencies:</p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-bash">git <span class="hljs-built_in">clone</span> https://github.com/yourusername/SonicRoutes-Server.git
<span class="hljs-built_in">cd</span> SonicRoutes-Server
pip install -r requirements.txt
</code></div></div></pre><h2 id="configuration">Configuration</h2><p>The server requires a configuration file named <code>config.py</code> with the following content:</p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-python">api_key = <span class="hljs-string">"YOUR_GOOGLE_MAPS_API_KEY"</span>
ip_address = <span class="hljs-string">"YOUR_SERVER_IP_ADDRESS"</span>
</code></div></div></pre><h2 id="usage">Usage</h2><p>To run the server, execute the following command:</p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-bash">python Server.py
</code></div></div></pre><h3 id="routes">Routes</h3><h4 id="getroute"><code>/getRoute</code></h4><p><strong>Method:</strong> <code>POST</code></p><p>Computes the best route between two points provided in the request body.</p><ul><li><p><strong>Request Body:</strong></p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"point1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"latitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43.7175</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"longitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.3942</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"point2"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"latitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43.7200</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"longitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.4000</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li><li><p><strong>Response:</strong></p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span><span class="hljs-number">43.7175</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10.3942</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">[</span><span class="hljs-number">43.7180</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10.3950</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    ...
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li></ul><h4 id="getcrossingcoordinates"><code>/getCrossingCoordinates/&lt;int:crossing_id&gt;</code></h4><p><strong>Method:</strong> <code>GET</code></p><p>Returns the coordinates of a specific crossing.</p><ul><li><strong>Response:</strong><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"crossing_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"latitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43.7175</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"longitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.3942</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li></ul><h4 id="getcrossings"><code>/getCrossings/&lt;string:city&gt;</code></h4><p><strong>Method:</strong> <code>GET</code></p><p>Returns a list of crossings for a specific city.</p><ul><li><strong>Response:</strong><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"crossings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"coordinates"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"latitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43.7175</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"longitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.3942</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"streetNames"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Street 1"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Street 2"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li></ul><h4 id="upload"><code>/upload</code></h4><p><strong>Method:</strong> <code>POST</code></p><p>Uploads new measurements and updates the GraphML file.</p><ul><li><p><strong>Request Body:</strong></p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"endCrossingId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"measurements"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"amplitude"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"startCrossingId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li><li><p><strong>Response:</strong></p><pre><div class="dark bg-gray-950 rounded-md border-[0.5px] border-token-border-medium"><div class="flex items-center relative text-token-text-secondary bg-token-main-surface-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md"><span></span><div class="flex items-center"><span class="" data-state="closed"></span></div></div><div class="overflow-y-auto p-4 text-left undefined" dir="ltr"><code class="!whitespace-pre hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Data saved successfully"</span>
<span class="hljs-punctuation">}</span>
</code></div></div></pre></li></ul><h3 id="webinterface">Web Interface</h3><h4 id="home"><code>/</code></h4><p>Renders the main page.</p><h4 id="mappa_count"><code>/mappa_count</code></h4><p>Renders a map with street segments colored based on noise count.</p><h4 id="mappa_rumori"><code>/mappa_rumori</code></h4><p>Renders a map with street segments colored based on noise amplitude.</p><h2 id="helper-functions">Helper Functions</h2><p>The following helper functions are defined in the <code>Server.py</code> file:</p><ul><li><code>find_best_path(graph_file, start_node_id, end_node_id)</code></li><li><code>update_graphml(data, file_path)</code></li><li><code>load_graph_from_json(json_file)</code></li><li><code>load_nodes_from_csv(csv_file)</code></li><li><code>build_graph(graph_file)</code></li><li><code>find_best_path(graph_file, start_node_id, end_node_id, data)</code></li><li><code>snap_to_road(latitude1, longitude1, latitude2, longitude2, path)</code></li><li><code>haversine(lat1, lon1, lat2, lon2)</code></li><li><code>setup_graphml(json_data, file_path)</code></li><li><code>remove_namespace(elem)</code></li></ul><h2 id="file-structure">File Structure</h2><ul><li><code>Server.py</code>: Main server code.</li><li><code>App.py</code>: Web interface code.</li><li><code>config.py</code>: Configuration file.</li><li><code>data/</code>: Directory containing CSV and GraphML files.</li><li><code>templates/</code>: HTML templates for the web interface.</li></ul><p>This documentation provides a comprehensive overview of the SonicRoutes server, including its setup, configuration, and usage details. Ensure to replace placeholders like <code>YOUR_GOOGLE_MAPS_API_KEY</code> and <code>YOUR_SERVER_IP_ADDRESS</code> in the configuration file with your actual values.</p>
<h2>Contributors</h2>
<ul>
<li><a href="https://github.com/baffobello14" target="_new">Giulio Bello</a></li>
<li><a href="https://github.com/giuliocapecchi" target="_new">Giulio Capecchi</a></li>
<li><a href="https://github.com/fratifederico" target="_new">Federico Frati</a></li>
<li><a href="https://github.com/jacoponiccolai" target="_new">Jacopo Niccolai</a></li>

</ul></div></div></div></div><div class="mt-1 flex gap-3 empty:hidden juice:-ml-3"><div class="items-center justify-start rounded-xl p-1 flex"><div class="flex items-center">

<span class="" data-state="closed"><button class="rounded-lg text-token-text-secondary hover:bg-token-main-surface-secondary"><span class="flex h-[30px] w-[30px] items-center justify-center"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-md-heavy">
